<import src="/template/purchase/purchase.wxml" />
<import src="/template/empty/empty.wxml" />

<view class="container" wx:if="{{ready}}">

  <view class="page-head">
    <view class="search">
      <view class="search-input">
        <input value="{{searchKey}}" placeholder="输入菜名进行搜索" bindinput="onSearchInput" />
        <view class="search-cancel" wx:if="{{searchKey}}" catchtap="onSearchCancel">
          <icon type="cancel" size="18" color="#666" />
        </view>
      </view>
      <view class="search-icon" catchtap="onSearch">
        <icon type="search" size="18" color="#777" />
      </view>
      <view class="search-history {{showItemsType=='history' && !searching ? 'active' : ''}}" catchtap="onSearchHistory">常购清单</view>
    </view>
    <view class="cates">
      <view class="level1Cates">
        <block wx:for="{{level1Cates}}" wx:key="" wx:for-item="level1Cate">
          <view class="level1Cate {{showItemsType=='category' && !searching && level1Cate.active ? 'active' : ''}}" data-id="{{level1Cate.id}}" catchtap="onLevel1CateTap">{{level1Cate.title}}</view>
        </block>
      </view>
      <view class="level2Cates" wx:if="{{level2Cates.length}}">
        <block wx:for="{{level2Cates}}" wx:key="" wx:for-item="level2Cate">
          <view class="level2Cate {{showItemsType=='category' && !searching && level2Cate.active ? 'active' : ''}}" data-id="{{level2Cate.id}}" catchtap="onLevel2CateTap">{{level2Cate.title}}</view>
        </block>
      </view>
    </view>
  </view>

  <template is="items" data="{{items, youImageMode_v2}}" />

  <template is="purchase" data="{{...purchase, youImageMode_v2}}" />

  <template is="empty" data="{{show: !items.length, message: '该类目下没有商品'}}" />

</view>

<template name="items">
  <view class="items">
    <block wx:for="{{items}}" wx:key="">
      <view class="item" data-id="{{item.id}}" catchtap="onItemTap" catchlongpress="onItemLongPress">
        <view class="item-image">
          <image src="{{item.images[0] + youImageMode_v2}}" />
        </view>
        <view class="item-title">{{item.title}}</view>
        <view class="item-price">￥{{item.price}}</view>
        <view class="item-num" wx:if="{{item.num}}">{{item.num}}</view>
      </view>
    </block>
  </view>
</template>

